<!DOCTYPE html>
<html lang="="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Viaje a Salta</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <button id="modo-btn">馃寵 Modo oscuro</button>
  <h1>Viaje a Salta</h1>
  <div class="nota">Will y Abril 馃挄</div>
  <div class="countdown" id="countdown">Cargando cuenta regresiva...</div>
  <div class="mapa">
    <iframe src="https://www.google.com/maps?q=De谩n+Funes+1380,+Salta,+Argentina&output=embed" allowfullscreen></iframe>
  </div>
  <div class="documentos">
    <h2>馃搸 Documentos del viaje</h2>
    <ul>
      <li><a href="STC - Imprimir boleto electr贸nico-abril.pdf" target="_blank">馃 Pasaje de Abril (PDF)</a></li>
      <li><a href="STC - Imprimir boleto electr贸nico-willi.pdf" target="_blank">馃 Pasaje de Willi (PDF)</a></li>
    </ul>
  </div>
  <div class="checklist">
    <h2>馃С Checklist de viaje</h2>
    <ul>
      <li><input type="checkbox"> Documentos</li>
      <li><input type="checkbox"> Ropa c贸moda</li>
      <li><input type="checkbox"> Celular cargado</li>
      <li><input type="checkbox"> Cargador de celular</li>
      <li><input type="checkbox"> Protector solar</li>
      <li><input type="checkbox"> Anteojos de sol</li>
      <li><input type="checkbox"> Mochila liviana</li>
      <li><input type="checkbox"> Zapatillas c贸modas</li>
      <li><input type="checkbox"> Mate (somos argentinos 馃槑)</li>
      <li><input type="checkbox"> Tarjetas / efectivo</li>
      <li><input type="checkbox"> DNI / Pasajes impresos</li>
      <li><input type="checkbox"> Auriculares</li>
    </ul>
  </div>
  <div class="gastos-remotos">
    <h2>馃寪 Registrar gasto compartido</h2>
    <form id="form-google">
      <input type="text" id="descripcion" placeholder="Descripci贸n" required>
      <input type="number" id="monto" placeholder="Monto (ARS)" required>
      <button type="submit">Guardar gasto</button>
    </form>
    <p id="msg"></p>
  </div>
  <div class="gastos-web">
    <h2>馃搳 Gastos cargados</h2>
    <table id="tabla-gastos">
      <thead>
        <tr><th>Fecha</th><th>Descripci贸n</th><th>Monto</th></tr>
      </thead>
      <tbody><tr><td colspan="3">Cargando gastos...</td></tr></tbody>
    </table>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
  <script>
    const countdown = document.getElementById("countdown");
    const targetDate = new Date("2025-07-21T00:00:00").getTime();
    function updateCountdown() {
      const now = new Date().getTime();
      const d = targetDate - now;
      if (d < 0) return countdown.innerHTML = "隆Ya comenz贸 el viaje! 鉁堬笍";
      const days = Math.floor(d / (1000 * 60 * 60 * 24));
      const hours = Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((d % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((d % (1000 * 60)) / 1000);
      countdown.innerHTML = `鈴?Faltan <strong>${days}</strong>d <strong>${hours}</strong>h <strong>${minutes}</strong>m <strong>${seconds}</strong>s 鉁堬笍`;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    document.getElementById("modo-btn").addEventListener("click", () => {
      document.body.classList.toggle("dark");
      localStorage.setItem("modo", document.body.classList.contains("dark") ? "dark" : "light");
    });
    if (localStorage.getItem("modo") === "dark") document.body.classList.add("dark");

    document.getElementById("form-google").addEventListener("submit", async function (e) {
      e.preventDefault();
      const desc = document.getElementById("descripcion").value.trim();
      const monto = parseFloat(document.getElementById("monto").value);
      const msg = document.getElementById("msg");
      msg.innerText = "Enviando...";
      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbytGeiFlJS5-sRun_nNuZxA8M5xY0xmTu6MVRfUR6f_-0m7aJkErBYdmGcL9a_TIXaw-Q/exec", {
          method: "POST",
          body: JSON.stringify({ descripcion: desc, monto: monto }),
          headers: { "Content-Type": "application/json" }
        });
        msg.innerText = res.ok ? "鉁?Gasto registrado" : "鉂?Error al enviar";
        if (res.ok) this.reset();
      } catch {
        msg.innerText = "鉂?Error de conexi贸n";
      }
    });

    function cargarGastos() {
      Tabletop.init({
        key: '1uWKpiLSzBQcm9HZhdUTWwTrZ-1AGWM-NojE9dk9frjk',
        callback: function (data) {
          const tbody = document.querySelector("#tabla-gastos tbody");
          tbody.innerHTML = "";
          data.reverse().forEach(row => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${row.Fecha}</td><td>${row.Descripci贸n}</td><td>$${parseFloat(row.Monto).toLocaleString()}</td>`;
            tbody.appendChild(tr);
          });
        },
        simpleSheet: true
      });
    }
    window.addEventListener("DOMContentLoaded", cargarGastos);
  </script>
</body>
</html>
